---

- name: Install postfix base packages
  apt: pkg={{ item }} state=latest install_recommends=no
  with_items: [ 'postfix', 'postfix-pcre', 'bsd-mailx' ]

- name: Install SASL support if enabled
  apt: pkg=libsasl2-modules state=latest install_recommends=no
  when: ('client' in postfix)

- name: Divert original postfix configuration
  command: dpkg-divert --quiet --local --divert /etc/postfix/{{ item }}.dpkg-divert --rename /etc/postfix/{{ item }}
           creates=/etc/postfix/{{ item }}.dpkg-divert
  with_items: [ 'main.cf', 'master.cf' ]
  notify: Restart postfix

- name: Divert original aliases database
  command: dpkg-divert --quiet --local --divert /etc/aliases.dpkg-divert --rename /etc/aliases
           creates=/etc/aliases.dpkg-divert


