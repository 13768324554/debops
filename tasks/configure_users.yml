---

- name: Make sure required system groups exist
  group:
    name:   '{{ item.group  | d(item.user) }}'
    system: '{{ item.system | d(True) }}'
    state: 'present'
  with_items: fcgiwrap_instances
  when: item.user | d(False)

- name: Make sure required system accounts exist
  user:
    name:       '{{ item.user }}'
    group:      '{{ item.group      | d(item.user) }}'
    shell:      '{{ item.shell      | d(omit) }}'
    home:       '{{ item.home       | d(omit) }}'
    createhome: '{{ item.createhome | d(False) }}'
    system:     '{{ item.system     | d(True) }}'
    state:      'present'
  with_items: fcgiwrap_instances
  when: item.user | d(False)

