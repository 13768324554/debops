---

- name: Configure timezone with timedatectl
  shell: 'timedatectl set-timezone {{ ntp__timezone }}'
  when: (ntp__timezone|d() and
         (ansible_local is undefined or
          (ansible_local|d() and ansible_local.timezone|d() and
           ntp__timezone != ansible_local.timezone)))

- name: Make sure conf override dir exists
  file:
    path: '/etc/systemd/timesyncd.conf.d'
    state: 'directory'
    owner: 'root'
    group: 'root'
    mode: '0755'

- name: Configure systemd-timesyncd
  template:
    src: 'etc/systemd/timesyncd.conf.d/ansible.conf.j2'
    dest: '/etc/systemd/timesyncd.conf.d/ansible.conf'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: [ 'Restart systemd-timesyncd' ]
