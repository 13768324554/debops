---

# Warning: this is not full backup playbook! It only backs up enough data to
# restore host to it's operational state (SSH host keys, monkeysphere GnuPG
# keys, autogenerated self-signed certificates).

# Data backed up is sensitive (host private keys) and should be treated as
# such. It will be backed up into "secret" Ansible directory, if configured in
# the inventory.

- hosts: all:!localhost
  sudo: yes

  vars:
    pki_path: '/srv/pki'

  roles:
    - role: ginas.secret

  tasks:
    - include: roles/sshd/tasks/backup.yml
    - include: roles/monkeysphere/tasks/backup.yml
    - include: roles/pki/tasks/backup.yml
    - include: roles/boxbackup/tasks/backup.yml

