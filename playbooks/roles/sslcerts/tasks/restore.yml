---

- name: Create local certificate store
  file: state=directory path=/usr/local/etc/ssl/certs owner=root group=root mode=0755
  tags: system_restore

- name: Create local certificate key store
  file: state=directory path=/usr/local/etc/ssl/private owner=root group=root mode=0700
  tags: system_restore

- name: Restore backed up self-signed certificates in case of reinstall (600)
  copy: src={{ secret }}/storage/sensitive/sslcerts/{{ ansible_fqdn }}/{{ item }} dest=/{{ item }} owner=root group=root mode=0600
  when: secret is defined and secret
  with_items:
    - '/usr/local/etc/ssl/private/{{ ansible_fqdn }}.key'
  tags: system_restore

- name: Restore backed up self-signed certificates in case of reinstall (644)
  copy: src={{ secret }}/storage/sensitive/sslcerts/{{ ansible_fqdn }}/{{ item }} dest=/{{ item }} owner=root group=root mode=0644
  when: secret is defined and secret
  with_items:
    - '/usr/local/etc/ssl/certs/{{ ansible_fqdn }}.crt'
  tags: system_restore


